<?xml version="1.0" encoding="UTF-8"?>
<prompt>
  <metadata>
    <title>Implement Onboarding Theme Selection UI</title>
    <phase>Onboarding &amp; Deck Creation</phase>
    <difficulty>medium</difficulty>
    <estimated_time>60-90 minutes</estimated_time>
    <version>1.0</version>
    <last_updated>2025-11-21</last_updated>
    <prerequisites>
      <prerequisite>Stack Auth integrated</prerequisite>
      <prerequisite>Basic Card components available</prerequisite>
    </prerequisites>
  </metadata>

  <thinking_configuration>
    <claude_extended_thinking>
      <enabled>true</enabled>
      <reasoning>
        Requires designing a visually engaging selection interface that communicates "work in progress" (queue) effectively without blocking the user completely. Needs to handle state transitions smoothly.
      </reasoning>
      <budget_tokens>10000</budget_tokens>
      <expected_thinking_depth>
        Analyze UX for "waiting for deck" state. Compare polling vs. optimistic UI.
      </expected_thinking_depth>
    </claude_extended_thinking>
  </thinking_configuration>

  <context>
    <project_info>
      <name>Mindspark Duel</name>
      <framework>Next.js 16 (App Router)</framework>
      <status>MVP Development</status>
    </project_info>

    <objective>
      <primary>
        Create the Onboarding flow where new users select one of 3 core themes. Upon selection, show a "Deck Creation in Progress" screen, indicating that their unique deck is being generated in the background.
      </primary>
      <success_criteria>
        <criterion>✅ User can select 1 of 3 themes</criterion>
        <criterion>✅ UI shows representative card art for each theme</criterion>
        <criterion>✅ "Processing" state clearly communicates that cards are being generated</criterion>
      </success_criteria>
    </objective>
  </context>

  <instructions>
    <step number="1">
      <title>Create Theme Selection Page</title>
      <thinking_guidance>
        Design a page `/onboarding` that checks if the user already has a deck. If not, display 3 cards representing the themes:
        1. **Technomancer's Legion** (Sci-Fi/Math bias)
        2. **Grove Guardians** (Nature/Biology bias)
        3. **Arcane Scholars** (Fantasy/Logic bias)
        Use the existing `Card` component but with "Hero" styling.
      </thinking_guidance>
      <action>
        Create `src/app/onboarding/page.tsx` and `src/components/onboarding/ThemeSelector.tsx`.
      </action>
    </step>

    <step number="2">
      <title>Implement Selection Logic</title>
      <thinking_guidance>
        When a theme is selected, trigger a Server Action `startDeckGeneration(themeId)`. This should:
        1. Create a `UserDeck` record (or similar) with status 'generating'.
        2. Redirect user to `/dashboard` or refresh the state to show the "Generating" view.
      </thinking_guidance>
      <action>
        Implement `startDeckGeneration` action in `src/app/actions/deck.ts`.
      </action>
    </step>

    <step number="3">
      <title>Create "Deck Generating" View</title>
      <thinking_guidance>
        Create a component `DeckGenerationStatus` that displays a progress bar or queue position.
        It should explain: "Your unique deck is being crafted by the AI..."
        Use a polling mechanism or simple "Check Status" button for MVP.
      </thinking_guidance>
      <action>
        Create `src/components/onboarding/DeckGenerationStatus.tsx`.
      </action>
    </step>
  </instructions>

  <validation>
    <execution_checklist>
      <item>✅ User sees 3 distinct theme options</item>
      <item>✅ Clicking a theme initiates the process</item>
      <item>✅ UI updates to show "Generating" state</item>
    </execution_checklist>
  </validation>

  <output_format>
    <structure>
      <section name="execution_log">Steps taken</section>
      <section name="results">Components created</section>
    </structure>
    <format>Markdown</format>
  </output_format>
</prompt>
